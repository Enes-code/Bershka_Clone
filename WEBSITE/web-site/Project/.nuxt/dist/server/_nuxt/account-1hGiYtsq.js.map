{"version":3,"file":"account-1hGiYtsq.js","sources":["../../../../components/atoms/Button.vue","../../../../stores/user.ts","../../../../pages/account.vue"],"sourcesContent":["<template>\r\n  <button class=\"btn\" :type=\"type\"><slot /></button>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nwithDefaults(defineProps<{ type?: 'button' | 'submit' }>(), { type: 'button' })\r\n</script>\r\n\r\n<style scoped>\r\n.btn {\r\n  border: 1px solid #000;\r\n  background: #000;\r\n  color: #fff;\r\n  padding: 10px 14px;\r\n  font-weight: 700;\r\n  cursor: pointer;\r\n}\r\n</style>\r\n\r\n","import { defineStore } from 'pinia'\r\nimport { doc, setDoc, updateDoc, getDoc } from 'firebase/firestore'\r\nimport type { User, Address } from '~/types/user'\r\n\r\nexport const useUserStore = defineStore('user', () => {\r\n  const user = ref<User | null>(null)\r\n  const loading = ref(false)\r\n  const error = ref<string | null>(null)\r\n  const isAuthenticated = ref(false)\r\n\r\n  const { $db } = useNuxtApp()\r\n\r\n  async function upsertUserProfile(userId: string, userData: Partial<User>) {\r\n    loading.value = true\r\n    error.value = null\r\n    try {\r\n      const userRef = doc($db, 'users', userId)\r\n      const userSnap = await getDoc(userRef)\r\n      \r\n      const updateData = {\r\n        ...userData,\r\n        updatedAt: new Date()\r\n      }\r\n\r\n      if (userSnap.exists()) {\r\n        await updateDoc(userRef, updateData)\r\n      } else {\r\n        await setDoc(userRef, {\r\n          id: userId,\r\n          ...updateData,\r\n          createdAt: new Date(),\r\n          addresses: [],\r\n          isEmailVerified: false\r\n        })\r\n      }\r\n\r\n      // Refresh user data\r\n      const updatedSnap = await getDoc(userRef)\r\n      if (updatedSnap.exists()) {\r\n        user.value = {\r\n          id: updatedSnap.id,\r\n          ...updatedSnap.data(),\r\n          createdAt: updatedSnap.data().createdAt?.toDate() || new Date(),\r\n          updatedAt: updatedSnap.data().updatedAt?.toDate() || new Date()\r\n        } as User\r\n      }\r\n    } catch (err) {\r\n      error.value = err instanceof Error ? err.message : 'Failed to update user profile'\r\n      console.error('Error updating user profile:', err)\r\n      throw err\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  async function updateUserAddress(userId: string, addressId: string, addressData: Partial<Address>) {\r\n    loading.value = true\r\n    error.value = null\r\n    try {\r\n      const userRef = doc($db, 'users', userId)\r\n      const userSnap = await getDoc(userRef)\r\n      \r\n      if (userSnap.exists()) {\r\n        const userData = userSnap.data() as User\r\n        const addresses = userData.addresses || []\r\n        const addressIndex = addresses.findIndex(addr => addr.id === addressId)\r\n        \r\n        if (addressIndex > -1) {\r\n          addresses[addressIndex] = { ...addresses[addressIndex], ...addressData }\r\n        } else {\r\n          addresses.push({ ...addressData, id: addressId } as Address)\r\n        }\r\n\r\n        await updateDoc(userRef, {\r\n          addresses,\r\n          updatedAt: new Date()\r\n        })\r\n\r\n        // Refresh user data\r\n        const updatedSnap = await getDoc(userRef)\r\n        if (updatedSnap.exists()) {\r\n          user.value = {\r\n            id: updatedSnap.id,\r\n            ...updatedSnap.data(),\r\n            createdAt: updatedSnap.data().createdAt?.toDate() || new Date(),\r\n            updatedAt: updatedSnap.data().updatedAt?.toDate() || new Date()\r\n          } as User\r\n        }\r\n      }\r\n    } catch (err) {\r\n      error.value = err instanceof Error ? err.message : 'Failed to update address'\r\n      console.error('Error updating address:', err)\r\n      throw err\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  function setUser(userData: User | null) {\r\n    user.value = userData\r\n    isAuthenticated.value = !!userData\r\n  }\r\n\r\n  return {\r\n    user,\r\n    loading,\r\n    error,\r\n    isAuthenticated,\r\n    upsertUserProfile,\r\n    updateUserAddress,\r\n    setUser\r\n  }\r\n})\r\n\r\n","<template>\r\n  <div class=\"account-page\">\r\n    <div class=\"container\">\r\n      <BaseText tag=\"h1\" size=\"2xl\" weight=\"bold\" class=\"page-title\">Hesabım</BaseText>\r\n      \r\n      <div v-if=\"!userStore.isAuthenticated\" class=\"not-authenticated\">\r\n        <BaseText tag=\"p\" size=\"lg\">Giriş yapmanız gerekiyor</BaseText>\r\n        <NuxtLink to=\"/\" class=\"login-link\">\r\n          <Button>Giriş Yap</Button>\r\n        </NuxtLink>\r\n      </div>\r\n\r\n      <div v-else class=\"account-content\">\r\n        <div class=\"account-tabs\">\r\n          <button\r\n            v-for=\"tab in tabs\"\r\n            :key=\"tab.id\"\r\n            @click=\"activeTab = tab.id\"\r\n            :class=\"{ active: activeTab === tab.id }\"\r\n            class=\"tab-button\"\r\n          >\r\n            {{ tab.label }}\r\n          </button>\r\n        </div>\r\n\r\n        <div class=\"tab-content\">\r\n          <div v-if=\"activeTab === 'orders'\">\r\n            <BaseText tag=\"h2\" size=\"lg\" weight=\"bold\">Siparişlerim</BaseText>\r\n            <div v-if=\"ordersStore.loading\" class=\"loading\">Yükleniyor...</div>\r\n            <div v-else-if=\"ordersStore.orders.length === 0\" class=\"empty-state\">\r\n              <BaseText tag=\"p\" size=\"md\">Henüz siparişiniz yok</BaseText>\r\n            </div>\r\n            <div v-else class=\"orders-list\">\r\n              <div v-for=\"order in ordersStore.orders\" :key=\"order.id\" class=\"order-card\">\r\n                <BaseText tag=\"h3\" size=\"md\" weight=\"semibold\">Sipariş #{{ order.id }}</BaseText>\r\n                <BaseText tag=\"p\" size=\"sm\">Durum: {{ order.status }}</BaseText>\r\n                <BaseText tag=\"p\" size=\"md\" weight=\"bold\">Toplam: {{ formatPrice(order.total) }} {{ order.currency }}</BaseText>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport Button from '~/components/atoms/Button.vue'\r\n\r\nconst userStore = useUserStore()\r\nconst ordersStore = useOrdersStore()\r\n\r\nconst activeTab = ref('orders')\r\n\r\nconst tabs = [\r\n  { id: 'orders', label: 'Siparişlerim' }\r\n]\r\n\r\nfunction formatPrice(price: number): string {\r\n  return price.toFixed(2)\r\n}\r\n\r\nonMounted(async () => {\r\n  if (userStore.user?.id) {\r\n    await ordersStore.fetchUserOrders(userStore.user.id)\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.account-page {\r\n  min-height: 100vh;\r\n  padding: 2rem;\r\n}\r\n\r\n.container {\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.page-title {\r\n  text-align: center;\r\n  margin-bottom: 2rem;\r\n  text-transform: uppercase;\r\n  letter-spacing: 0.1em;\r\n}\r\n\r\n.not-authenticated {\r\n  text-align: center;\r\n  padding: 4rem;\r\n  background: white;\r\n}\r\n\r\n.login-link {\r\n  text-decoration: none;\r\n  display: inline-block;\r\n  margin-top: 2rem;\r\n}\r\n\r\n.account-content {\r\n  background: white;\r\n  padding: 2rem;\r\n  border-radius: 8px;\r\n}\r\n\r\n.account-tabs {\r\n  display: flex;\r\n  gap: 1rem;\r\n  margin-bottom: 2rem;\r\n  border-bottom: 1px solid #eee;\r\n}\r\n\r\n.tab-button {\r\n  padding: 1rem 2rem;\r\n  border: none;\r\n  background: transparent;\r\n  cursor: pointer;\r\n  font-weight: 500;\r\n  border-bottom: 2px solid transparent;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.tab-button:hover {\r\n  border-bottom-color: #ddd;\r\n}\r\n\r\n.tab-button.active {\r\n  border-bottom-color: #000;\r\n  font-weight: 600;\r\n}\r\n\r\n.tab-content {\r\n  padding: 2rem 0;\r\n}\r\n\r\n.loading,\r\n.empty-state {\r\n  text-align: center;\r\n  padding: 4rem;\r\n}\r\n\r\n.orders-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 1.5rem;\r\n}\r\n\r\n.order-card {\r\n  padding: 1.5rem;\r\n  border: 1px solid #eee;\r\n  border-radius: 8px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.5rem;\r\n}\r\n</style>\r\n\r\n"],"names":["_ssrRenderAttrs","_mergeProps","_push","_parent","_unref","_","_scopeId","_createVNode","_ssrRenderList","_ssrInterpolate","_toDisplayString"],"mappings":"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"}