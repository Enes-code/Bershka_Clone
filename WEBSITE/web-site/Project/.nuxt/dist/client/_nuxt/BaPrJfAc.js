import{_ as U}from"./QDa3abFm.js";import{g as N,c as r,o as i,p as V,_ as F,q as $,l as h,s as G,v as z,x as k,y as B,z as H,A as I,a as D,b as d,w as l,k as m,F as C,r as E,n as L,B as O,d as u,C as P,t as w}from"./C75LhAwq.js";import{u as R}from"./CONyt60p.js";const Y=["type"],q=N({__name:"Button",props:{type:{default:"button"}},setup(c){return(a,o)=>(i(),r("button",{class:"btn",type:c.type},[V(a.$slots,"default",{},void 0)],8,Y))}}),M=F(q,[["__scopeId","data-v-3ebb440a"]]),j=$("user",()=>{const c=h(null),a=h(!1),o=h(null),p=h(!1),{$db:b}=G();async function A(t,_){a.value=!0,o.value=null;try{const e=z(b,"users",t),n=await k(e),v={..._,updatedAt:new Date};n.exists()?await B(e,v):await H(e,{id:t,...v,createdAt:new Date,addresses:[],isEmailVerified:!1});const f=await k(e);f.exists()&&(c.value={id:f.id,...f.data(),createdAt:f.data().createdAt?.toDate()||new Date,updatedAt:f.data().updatedAt?.toDate()||new Date})}catch(e){throw o.value=e instanceof Error?e.message:"Failed to update user profile",console.error("Error updating user profile:",e),e}finally{a.value=!1}}async function x(t,_,e){a.value=!0,o.value=null;try{const n=z(b,"users",t),v=await k(n);if(v.exists()){const g=v.data().addresses||[],S=g.findIndex(T=>T.id===_);S>-1?g[S]={...g[S],...e}:g.push({...e,id:_}),await B(n,{addresses:g,updatedAt:new Date});const y=await k(n);y.exists()&&(c.value={id:y.id,...y.data(),createdAt:y.data().createdAt?.toDate()||new Date,updatedAt:y.data().updatedAt?.toDate()||new Date})}}catch(n){throw o.value=n instanceof Error?n.message:"Failed to update address",console.error("Error updating address:",n),n}finally{a.value=!1}}function s(t){c.value=t,p.value=!!t}return{user:c,loading:a,error:o,isAuthenticated:p,upsertUserProfile:A,updateUserAddress:x,setUser:s}}),J={class:"account-page"},K={class:"container"},Q={key:0,class:"not-authenticated"},W={key:1,class:"account-content"},X={class:"account-tabs"},Z=["onClick"],ee={class:"tab-content"},te={key:0},se={key:0,class:"loading"},ae={key:1,class:"empty-state"},oe={key:2,class:"orders-list"},ne=N({__name:"account",setup(c){const a=j(),o=R(),p=h("orders"),b=[{id:"orders",label:"Siparişlerim"}];function A(x){return x.toFixed(2)}return I(async()=>{a.user?.id&&await o.fetchUserOrders(a.user.id)}),(x,s)=>{const t=O("BaseText"),_=U;return i(),r("div",J,[D("div",K,[d(t,{tag:"h1",size:"2xl",weight:"bold",class:"page-title"},{default:l(()=>[...s[0]||(s[0]=[u("Hesabım",-1)])]),_:1}),m(a).isAuthenticated?(i(),r("div",W,[D("div",X,[(i(),r(C,null,E(b,e=>D("button",{key:e.id,onClick:n=>p.value=e.id,class:P([{active:m(p)===e.id},"tab-button"])},w(e.label),11,Z)),64))]),D("div",ee,[m(p)==="orders"?(i(),r("div",te,[d(t,{tag:"h2",size:"lg",weight:"bold"},{default:l(()=>[...s[3]||(s[3]=[u("Siparişlerim",-1)])]),_:1}),m(o).loading?(i(),r("div",se,"Yükleniyor...")):m(o).orders.length===0?(i(),r("div",ae,[d(t,{tag:"p",size:"md"},{default:l(()=>[...s[4]||(s[4]=[u("Henüz siparişiniz yok",-1)])]),_:1})])):(i(),r("div",oe,[(i(!0),r(C,null,E(m(o).orders,e=>(i(),r("div",{key:e.id,class:"order-card"},[d(t,{tag:"h3",size:"md",weight:"semibold"},{default:l(()=>[u("Sipariş #"+w(e.id),1)]),_:2},1024),d(t,{tag:"p",size:"sm"},{default:l(()=>[u("Durum: "+w(e.status),1)]),_:2},1024),d(t,{tag:"p",size:"md",weight:"bold"},{default:l(()=>[u("Toplam: "+w(A(e.total))+" "+w(e.currency),1)]),_:2},1024)]))),128))]))])):L("",!0)])])):(i(),r("div",Q,[d(t,{tag:"p",size:"lg"},{default:l(()=>[...s[1]||(s[1]=[u("Giriş yapmanız gerekiyor",-1)])]),_:1}),d(_,{to:"/",class:"login-link"},{default:l(()=>[d(M,null,{default:l(()=>[...s[2]||(s[2]=[u("Giriş Yap",-1)])]),_:1})]),_:1})]))])])}}}),le=F(ne,[["__scopeId","data-v-f691ebec"]]);export{le as default};
